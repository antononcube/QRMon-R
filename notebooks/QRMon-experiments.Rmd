---
title: "QRMon experiments"
author: "Anton Antonov"
date: "1/19/2019"
output: html_notebook
---

```{r}
library(magrittr)
library(ggplot2)
library(quantreg)
library(splines)
#library(QRMon)
devtools::load_all()
```


```{r}
source("../R/QRMon.R")
```

# Introduction

# Data

```{r}
data(airquality)
summary(airquality)
```

```{r}
library(MASS)
data(mcycle)
summary(mcycle)
```

# Main pipeline

## MASS dataset

```{r}
qrmon <-
  QRMonUnit( mcycle) %>%
  QRMonQuantileRegression( df = 12, degree = 3, quantiles = seq(0.2,0.8,0.2) ) %>% 
  QRMonPlot( dataPointsColor = "gray10", regressionCurvesColor = ~ RegressionCurve )
```


## Airquality dataset 

```{r}
data("airquality")
qrmon <-
  QRMonUnit( airquality[, c("Day", "Ozone")] ) %>%
  QRMonQuantileRegression( df = 12, degree = 3, quantiles = seq(0.2,0.8,0.2) ) %>% 
  QRMonPlot( dataPointsColor = "gray10", regressionCurvesColor = ~ RegressionCurve )
```
# Outliers

```{r}
qrmon <-
  qrmon %>% 
  QRMonSetRegressionObjects(NULL) %>% 
  QRMonQuantileRegression( df = 12, quantiles = c(0.05, 0.95) ) %>% 
  QRMonOutliers() %>% 
  QRMonOutliersPlot( plotRegressionCurvesQ = TRUE )
```

# Errors

```{r}
data.189185 <-
  data.frame( 
    X = c(1387.5, 1302.5, 1222.5, 1182.5, 1142.5, 1097.5, 852.5, 897.5, 977.5,
          937.5, 812.5, 732.5, 652.5, 692.5, 567.5, 527.5, 447.5, 362.5, 322.5,
          282.5, 242.5, 202.5, 157.5, 1017.9, 77.5),
    Y = c( 266500., 263500., 245500., 238500., 231500., 230500., 224500., 
           224500., 222500., 220500., 217500., 195500., 183500., 183500., 
           176500., 172500., 162500., 145500., 127500., 109500., 93500., 71500., 
           48500., 47970.2, 15500.)
  )
```


```{r}
res <-
  QRMonUnit( data.189185 ) %>%
  QRMonQuantileRegression( df = 12, degree = 3, quantiles = 0.5 ) %>% 
  QRMonQuantileRegression( df = 3, degree = 2, quantiles = 0.55 ) %>% 
  QRMonPlot() %>% 
  QRMonErrorsPlot() %>% 
  QRMonTakeValue()
```


# Simulate

```{r}
qrmon <- qrmon %>% QRMonSimulate(100)
ggplot( qrmon %>% QRMonTakeValue() ) +
  geom_point( aes( x = Time, y = Value ), color = "blue" )
```

